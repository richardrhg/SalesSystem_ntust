<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å“¡å·¥éŠ·å”®ç®¡ç†ç³»çµ±</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI"
        crossorigin="anonymous"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="style.css">
    <script src="main.js"></script>
</head>

<body>
    <div class="navbar navbar-expand-lg">
        <div class="container">
            <a href="./index.html" id="navbar-title" class="navbar-brand">å“¡å·¥éŠ·å”®ç®¡ç†ç³»çµ±</a>
            <div class="navbar-nav navbar-nav-links">
                <a href="./employeePage.html" class="nav-link">å“¡å·¥ç®¡ç†</a>
                <a href="./productPage.html" class="nav-link">ç”¢å“ç®¡ç†</a>
                <a href="./salesPage.html" class="nav-link">éŠ·å”®ç®¡ç†</a>
                <a href="./reportPage.html" class="nav-link">å ±è¡¨ç®¡ç†</a>
            </div>
        </div>
    </div>
    
    <div class="container mt-4">
        <!-- æ­¡è¿å€å¡Š -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card border-0 shadow-sm">
                    <div class="card-body p-4">
                        <h1 class="display-5 mb-2">æ­¡è¿ä½¿ç”¨å“¡å·¥éŠ·å”®ç®¡ç†ç³»çµ±</h1>
                        <p class="lead text-muted mb-0">ç®¡ç†å“¡å·¥ã€ç”¢å“èˆ‡éŠ·å”®è¨˜éŒ„ï¼Œä¸¦é€éæ•¸æ“šåˆ†ææŒæ¡æ¥­å‹™ç‹€æ³</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- çµ±è¨ˆå¡ç‰‡ -->
        <div class="row mb-4">
            <div class="col-md-3 col-sm-6 mb-3">
                <div class="card text-white bg-primary h-100 shadow-sm">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h6 class="card-subtitle mb-2 opacity-75">å“¡å·¥ç¸½æ•¸</h6>
                                <h2 class="card-title mb-0" id="stat-employees">-</h2>
                            </div>
                            <div class="fs-1 opacity-50">ğŸ‘¥</div>
                        </div>
                    </div>
                    <div class="card-footer bg-transparent border-0">
                        <a href="./employeePage.html" class="text-white text-decoration-none">
                            æŸ¥çœ‹è©³æƒ… â†’
                        </a>
                    </div>
                </div>
            </div>
            
            <div class="col-md-3 col-sm-6 mb-3">
                <div class="card text-white bg-success h-100 shadow-sm">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h6 class="card-subtitle mb-2 opacity-75">ç”¢å“ç¸½æ•¸</h6>
                                <h2 class="card-title mb-0" id="stat-products">-</h2>
                            </div>
                            <div class="fs-1 opacity-50">ğŸ“¦</div>
                        </div>
                    </div>
                    <div class="card-footer bg-transparent border-0">
                        <a href="./productPage.html" class="text-white text-decoration-none">
                            æŸ¥çœ‹è©³æƒ… â†’
                        </a>
                    </div>
                </div>
            </div>
            
            <div class="col-md-3 col-sm-6 mb-3">
                <div class="card text-white bg-info h-100 shadow-sm">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h6 class="card-subtitle mb-2 opacity-75">éŠ·å”®è¨˜éŒ„</h6>
                                <h2 class="card-title mb-0" id="stat-sales">-</h2>
                            </div>
                            <div class="fs-1 opacity-50">ğŸ’°</div>
                        </div>
                    </div>
                    <div class="card-footer bg-transparent border-0">
                        <a href="./salesPage.html" class="text-white text-decoration-none">
                            æŸ¥çœ‹è©³æƒ… â†’
                        </a>
                    </div>
                </div>
            </div>
            
            <div class="col-md-3 col-sm-6 mb-3">
                <div class="card text-white bg-warning h-100 shadow-sm">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h6 class="card-subtitle mb-2 opacity-75">ç¸½éŠ·å”®é¡</h6>
                                <h2 class="card-title mb-0" id="stat-total-sales">-</h2>
                            </div>
                            <div class="fs-1 opacity-50">ğŸ’µ</div>
                        </div>
                    </div>
                    <div class="card-footer bg-transparent border-0">
                        <a href="./reportPage.html" class="text-white text-decoration-none">
                            æŸ¥çœ‹å ±è¡¨ â†’
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- å¿«é€Ÿå°èˆª -->
        <div class="row mb-4">
            <div class="col-12">
                <h3 class="mb-3">å¿«é€Ÿå°èˆª</h3>
            </div>
            <div class="col-md-3 col-sm-6 mb-3">
                <div class="card h-100 shadow-sm hover-shadow">
                    <div class="card-body text-center">
                        <div class="mb-3">
                            <span style="font-size: 3rem;">ğŸ‘¥</span>
                        </div>
                        <h5 class="card-title">å“¡å·¥ç®¡ç†</h5>
                        <p class="card-text text-muted">ç®¡ç†å“¡å·¥è³‡æ–™ã€è·ç¨±èˆ‡è˜ç”¨æ—¥æœŸ</p>
                        <a href="./employeePage.html" class="btn btn-primary">å‰å¾€ç®¡ç†</a>
                    </div>
                </div>
            </div>
            
            <div class="col-md-3 col-sm-6 mb-3">
                <div class="card h-100 shadow-sm hover-shadow">
                    <div class="card-body text-center">
                        <div class="mb-3">
                            <span style="font-size: 3rem;">ğŸ“¦</span>
                        </div>
                        <h5 class="card-title">ç”¢å“ç®¡ç†</h5>
                        <p class="card-text text-muted">ç®¡ç†ç”¢å“è³‡è¨Šèˆ‡å–®åƒ¹è¨­å®š</p>
                        <a href="./productPage.html" class="btn btn-success">å‰å¾€ç®¡ç†</a>
                    </div>
                </div>
            </div>
            
            <div class="col-md-3 col-sm-6 mb-3">
                <div class="card h-100 shadow-sm hover-shadow">
                    <div class="card-body text-center">
                        <div class="mb-3">
                            <span style="font-size: 3rem;">ğŸ›’</span>
                        </div>
                        <h5 class="card-title">éŠ·å”®ç®¡ç†</h5>
                        <p class="card-text text-muted">è¨˜éŒ„èˆ‡ç®¡ç†éŠ·å”®äº¤æ˜“è³‡æ–™</p>
                        <a href="./salesPage.html" class="btn btn-info">å‰å¾€ç®¡ç†</a>
                    </div>
                </div>
            </div>
            
            <div class="col-md-3 col-sm-6 mb-3">
                <div class="card h-100 shadow-sm hover-shadow">
                    <div class="card-body text-center">
                        <div class="mb-3">
                            <span style="font-size: 3rem;">ğŸ“Š</span>
                        </div>
                        <h5 class="card-title">å ±è¡¨ç®¡ç†</h5>
                        <p class="card-text text-muted">æŸ¥çœ‹æ•¸æ“šåˆ†æèˆ‡çµ±è¨ˆå ±è¡¨</p>
                        <a href="./reportPage.html" class="btn btn-warning">å‰å¾€å ±è¡¨</a>
                    </div>
                </div>
            </div>
        </div>

        <!-- æœ€è¿‘éŠ·å”®è¨˜éŒ„ -->
        <div class="row">
            <div class="col-12">
                <div class="card shadow-sm">
                    <div class="card-header bg-white">
                        <h5 class="mb-0">æœ€è¿‘éŠ·å”®è¨˜éŒ„</h5>
                    </div>
                    <div class="card-body">
                        <div id="recent-sales-container">
                            <div class="text-center text-muted py-4">
                                <div class="spinner-border" role="status">
                                    <span class="visually-hidden">è¼‰å…¥ä¸­...</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="footer">
        <p>Copyright Â© 2025 å“¡å·¥éŠ·å”®ç®¡ç†ç³»çµ±. All rights reserved.</p>
    </div>

    <style>
        .hover-shadow {
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .hover-shadow:hover {
            transform: translateY(-5px);
            box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15) !important;
        }
    </style>

    <script>
        // è¼‰å…¥å„€è¡¨æ¿æ•¸æ“š
        async function loadDashboardStats() {
            try {
                const response = await fetch('api.php?do=get_dashboard_stats');
                if (!response.ok) {
                    throw new Error('è¼‰å…¥å¤±æ•—');
                }
                const stats = await response.json();
                
                // æ›´æ–°çµ±è¨ˆå¡ç‰‡
                document.getElementById('stat-employees').textContent = stats.employee_count || 0;
                document.getElementById('stat-products').textContent = stats.product_count || 0;
                document.getElementById('stat-sales').textContent = stats.sale_count || 0;
                document.getElementById('stat-total-sales').textContent = 
                    '$' + (stats.total_sales || 0).toLocaleString('zh-TW', {
                        minimumFractionDigits: 0,
                        maximumFractionDigits: 0
                    });
                
                // é¡¯ç¤ºæœ€è¿‘éŠ·å”®è¨˜éŒ„
                const container = document.getElementById('recent-sales-container');
                if (stats.recent_sales && stats.recent_sales.length > 0) {
                    container.innerHTML = `
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>éŠ·å”®ç·¨è™Ÿ</th>
                                        <th>å“¡å·¥å§“å</th>
                                        <th>ç”¢å“åç¨±</th>
                                        <th>æ•¸é‡</th>
                                        <th>éŠ·å”®é¡</th>
                                        <th>æ—¥æœŸ</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${stats.recent_sales.map(sale => `
                                        <tr>
                                            <td>${sale.sale_id || ''}</td>
                                            <td>${sale.emp_name || ''}</td>
                                            <td>${sale.product_name || ''}</td>
                                            <td>${sale.quantity || ''}</td>
                                            <td>$${parseFloat(sale.sales_amount || 0).toLocaleString('zh-TW', {
                                                minimumFractionDigits: 0,
                                                maximumFractionDigits: 0
                                            })}</td>
                                            <td>${sale.sale_date || ''}</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    `;
                } else {
                    container.innerHTML = '<p class="text-center text-muted mb-0">ç›®å‰æ²’æœ‰éŠ·å”®è¨˜éŒ„</p>';
                }
            } catch (error) {
                console.error('è¼‰å…¥å„€è¡¨æ¿æ•¸æ“šå¤±æ•—:', error);
                document.getElementById('recent-sales-container').innerHTML = 
                    '<p class="text-center text-danger mb-0">è¼‰å…¥æ•¸æ“šå¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦</p>';
            }
        }
        
        // é é¢è¼‰å…¥æ™‚åŸ·è¡Œ
        document.addEventListener('DOMContentLoaded', function() {
            loadDashboardStats();
        });
    </script>
</body>

</html>
